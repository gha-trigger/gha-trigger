<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-index">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<title data-rh="true">gha-trigger | gha-trigger</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://suzuki-shunsuke.github.io/gha-trigger/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="gha-trigger | gha-trigger"><meta data-rh="true" name="description" content="License"><meta data-rh="true" property="og:description" content="License"><link data-rh="true" rel="icon" href="/gha-trigger/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://suzuki-shunsuke.github.io/gha-trigger/"><link data-rh="true" rel="alternate" href="https://suzuki-shunsuke.github.io/gha-trigger/" hreflang="en"><link data-rh="true" rel="alternate" href="https://suzuki-shunsuke.github.io/gha-trigger/" hreflang="x-default"><script data-rh="true">function maybeInsertBanner(){window.__DOCUSAURUS_INSERT_BASEURL_BANNER&&insertBanner()}function insertBanner(){var n=document.getElementById("docusaurus-base-url-issue-banner-container");if(n){n.innerHTML='\n<div id="docusaurus-base-url-issue-banner" style="border: thick solid red; background-color: rgb(255, 230, 179); margin: 20px; padding: 20px; font-size: 20px;">\n   <p style="font-weight: bold; font-size: 30px;">Your Docusaurus site did not load properly.</p>\n   <p>A very common reason is a wrong site <a href="https://docusaurus.io/docs/docusaurus.config.js/#baseurl" style="font-weight: bold;">baseUrl configuration</a>.</p>\n   <p>Current configured baseUrl = <span style="font-weight: bold; color: red;">/gha-trigger/</span> </p>\n   <p>We suggest trying baseUrl = <span id="docusaurus-base-url-issue-banner-suggestion-container" style="font-weight: bold; color: green;"></span></p>\n</div>\n';var e=document.getElementById("docusaurus-base-url-issue-banner-suggestion-container"),s=window.location.pathname,r="/"===s.substr(-1)?s:s+"/";e.innerHTML=r}}window.__DOCUSAURUS_INSERT_BASEURL_BANNER=!0,document.addEventListener("DOMContentLoaded",maybeInsertBanner)</script><link rel="stylesheet" href="/gha-trigger/assets/css/styles.1e83b2af.css">
<link rel="preload" href="/gha-trigger/assets/js/runtime~main.43206161.js" as="script">
<link rel="preload" href="/gha-trigger/assets/js/main.bdb7d4d2.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div id="docusaurus-base-url-issue-banner-container"></div><div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/gha-trigger/"><b class="navbar__title text--truncate">gha-trigger</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/suzuki-shunsuke/gha-trigger" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/gha-trigger/">gha-trigger</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gha-trigger/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gha-trigger/config/">Configuration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Configuration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/gha-trigger/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">gha-trigger</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>gha-trigger</h1><p><a href="https://raw.githubusercontent.com/suzuki-shunsuke/gha-triggger/main/LICENSE" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="http://img.shields.io/badge/license-mit-blue.svg?style=flat-square" alt="License" class="img_ev3q"></a></p><p><a href="https://github.com/suzuki-shunsuke/gha-triggger" target="_blank" rel="noopener noreferrer">https://github.com/suzuki-shunsuke/gha-triggger</a></p><p>GitHub App for Secure GitHub Actions</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="status">Status<a class="hash-link" href="#status" title="Direct link to heading">​</a></h2><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Under development. This doesn&#x27;t work yet.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="goal">Goal<a class="hash-link" href="#goal" title="Direct link to heading">​</a></h2><p>Run GitHub Actions Workflow securely.
Prevent GitHub Actions Workflow from being modifying and running malicious commands.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a class="hash-link" href="#background" title="Direct link to heading">​</a></h2><p>GitHub Actions is very powerful CI Platform, but also has a security risk that someone modifies workflow and CI scripts and run malicious commands.
For example, secrets with strong permission may be abused and stolen.</p><p>You can use other CI Platform to prevent workflows from being modifying, but we would like to use GitHub Actions because GitHub Actions is very powerful.</p><p>So we design the architecture and develop GitHub App to achieve the above goal.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="architecture">Architecture<a class="hash-link" href="#architecture" title="Direct link to heading">​</a></h2><p><img loading="lazy" src="https://user-images.githubusercontent.com/13323303/186283702-cb3d7de1-6bb0-45dc-8387-d251068484a1.png" alt="gha-trigger architecture" class="img_ev3q"></p><p>You create two GitHub repositories.</p><ul><li>Main Repository<ul><li>Users develop this repository</li><li>Disable GitHub Actions</li></ul></li><li>CI Repository<ul><li>Manage GitHub Actions Workflows and CI scripts</li><li>Only CI maintainers have write permissiono and other developers have only read permission</li></ul></li></ul><p>You install GitHub App <code>gha-trigger</code> in these repositories.
When events such as <code>push</code> and <code>pull_request</code> occur in Main Repository, the webhook is sent to <code>gha-trigger</code>.
<code>gha-trigger</code> validates and filters webhooks and triggers GitHub Actions Workflows of CI Repository via GitHub API.
Workflows of CI Repository update commit statuses of Main Repository and send pull request comments so that developers can refer CI results from Main Repository&#x27;s pull request pages.</p><p>The important thing is that workflows and CI scripts are managed at the repository other than <code>Main Repository</code> and only restricted people have the write permission of <code>CI Repository</code>.
This prevents developers from modifying workflows and CI scripts and makes GitHub Actions secure.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="supported-runtime">Supported runtime<a class="hash-link" href="#supported-runtime" title="Direct link to heading">​</a></h2><p>gha-trigger supports only AWS Lambda at the moment,
but we&#x27;re considering to support other platform such as Google Cloud Function too.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-rerun-and-cancel-ci">How to rerun and cancel CI<a class="hash-link" href="#how-to-rerun-and-cancel-ci" title="Direct link to heading">​</a></h2><p>Developers don&#x27;t have the write permission of CI Repository, so they can&#x27;t rerun and cancel workflows directly.
But they can rerun and cancel workflows via pull request comments.</p><ul><li>Rerun workflows: <code>/rerun-workflow &lt;workflow id&gt; [&lt;workflow id&gt; ...]</code></li><li>Rerun failed jobs: <code>/rerun-failed-jobs &lt;workflow id&gt; [&lt;workflow id&gt; ...]</code></li><li>Rerun jobs: <code>/rerun-job &lt;job id&gt; [&lt;job id&gt; ...]</code></li><li>Cancel workflows: <code>/cancel &lt;workflow id&gt; [&lt;workflow id&gt; ...]</code></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-trigger-workflows-manually">How to trigger workflows manually<a class="hash-link" href="#how-to-trigger-workflows-manually" title="Direct link to heading">​</a></h2><p>If you would like to add workflows that developers run manually, you have to create a repository for those workflows.
Let&#x27;s call the repository <code>Manual Trigger Repository</code>.
You have to install GitHub App in <code>Main Repository</code> and <code>Manual Trigger Repository</code> so that workflows can access <code>Main Repository</code>.
You also have to give developers the write permission of <code>Manual Trigger Repository</code>, so you have to be careful the treat of this repository.</p><p>One of the usecase of this repository we assume is that developers scaffold pull requests of Main Repository.</p><p>For example, <a href="https://github.com/suzuki-shunsuke/tfaction" target="_blank" rel="noopener noreferrer">tfaction</a> provides the feature.</p><p><a href="https://suzuki-shunsuke.github.io/tfaction/docs/feature/scaffold-working-dir" target="_blank" rel="noopener noreferrer">Scaffold working directory by GitHub Actions workflow_dispatch event</a></p><p>In that case, you can give GitHub App only permission to push commits to <code>Main Repository</code>.
If GitHub App can create pull requests to <code>Main Repository</code>, a developer can approve and merge them himself. This is risky so workflows should create only feature branches in <code>Main Repository</code> and let developers open pull requests themselves.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pros-and-cons">Pros and Cons<a class="hash-link" href="#pros-and-cons" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pros">Pros<a class="hash-link" href="#pros" title="Direct link to heading">​</a></h3><p>The pros of <code>gha-trigger</code> is that you can run GitHub Actions securely.
You can prevent GitHub Actions Workflow from being modifying and running malicious commands.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cons">Cons<a class="hash-link" href="#cons" title="Direct link to heading">​</a></h3><p>Compared with normal GitHub Actions usage, <code>gha-trigger</code> has some drawbacks.</p><ul><li><code>github.token</code> of <code>CI Repository</code> can&#x27;t be used to access <code>Main Repository</code></li><li>You have to fix workfows to migrate existing workflows to <code>gha-trigger</code></li><li><a href="https://docs.github.com/en/actions/learn-github-actions/contexts" target="_blank" rel="noopener noreferrer">Contexts</a> and <a href="https://docs.github.com/en/actions/learn-github-actions/environment-variables#default-environment-variables" target="_blank" rel="noopener noreferrer">Default environment variables</a> are different from original event<ul><li><code>gha-trigger</code> passes the event payload to Workflow as input</li></ul></li><li><code>gha-trigger</code> uses not Checks API but Commit Status API</li><li><code>gha-trigger</code> calls GitHub API so it has a risk of GitHub API rate limit issue</li><li>The experience for rerunning and canceling CI isn&#x27;t good</li><li>It spends money</li><li>You have to set up and maintain <code>gha-trigger</code><ul><li>Continous update</li><li>Monitoring</li><li>Trouble shooting and user support</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="license">LICENSE<a class="hash-link" href="#license" title="Direct link to heading">​</a></h2><p><a href="https://raw.githubusercontent.com/suzuki-shunsuke/gha-triggger/main/LICENSE" target="_blank" rel="noopener noreferrer">MIT</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/suzuki-shunsuke/gha-trigger-docs/edit/main/docs/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/gha-trigger/getting-started"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Getting Started</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#status" class="table-of-contents__link toc-highlight">Status</a></li><li><a href="#goal" class="table-of-contents__link toc-highlight">Goal</a></li><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#architecture" class="table-of-contents__link toc-highlight">Architecture</a></li><li><a href="#supported-runtime" class="table-of-contents__link toc-highlight">Supported runtime</a></li><li><a href="#how-to-rerun-and-cancel-ci" class="table-of-contents__link toc-highlight">How to rerun and cancel CI</a></li><li><a href="#how-to-trigger-workflows-manually" class="table-of-contents__link toc-highlight">How to trigger workflows manually</a></li><li><a href="#pros-and-cons" class="table-of-contents__link toc-highlight">Pros and Cons</a><ul><li><a href="#pros" class="table-of-contents__link toc-highlight">Pros</a></li><li><a href="#cons" class="table-of-contents__link toc-highlight">Cons</a></li></ul></li><li><a href="#license" class="table-of-contents__link toc-highlight">LICENSE</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/suzuki-shunsuke/gha-trigger" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/suzuki-shunsuke/gha-trigger-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Document Repository<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Shunsuke Suzuki. Built with Docusaurus.</div></div></div></footer></div>
<script src="/gha-trigger/assets/js/runtime~main.43206161.js"></script>
<script src="/gha-trigger/assets/js/main.bdb7d4d2.js"></script>
</body>
</html>